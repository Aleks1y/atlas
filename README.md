#Общее

Взаимодействие происходит в формате JSON с помощью двух очередей rabbitmq: regression_queue_input,
regression_queue_output - для отправки запросов и получения результатов выполнения запросов соответственно.
###Формат входных данных
Запрос содержит следующие поля:
- action - тип запрашивоемой операции. Возможные значения:
    - load_data - загрузить данные с сервера.
    - train_polynom_model - построить модель на основе полинома третей степени аналитическим способом
    - train_gradient_model - построить модель на основе полинома четвертой степени с помощью стохастического градиентного спуска
    - predict - получить предсказания для заданных параметров
- id - идентификатор запроса, который будет содержаться в ответном сообщении. Необходим для запросов на получения предсказаний
- params - объект с дополнительными параметрами запроса.
```
request = {
    "id": string,
    "action": string,
    "params": object
}
```
# Загрузка данных
Загрузка данных осуществляется примерно 2 часа. Для её выполнения достаточно отправить запрос:
```
{
    "action": "load_data",
}
```

# Тренировка модели на основе полинома третей степени
Коэффициенты такой модели вычисляются аналитическим способом, это занимает около трёх минут. В поле _params_ запроса можно указать коэффициент регуляризации _alpha_, котрый по умолчанию равен 0.0001.

Пример запроса:
```
{
    "action": "train_polynom_model",
    "params":{
        "alpha": 0.001
    }
}
```

# Тренировка модели на основе полинома четвертой степени
Коэффициенты такой модели вычисляются с помощью стохастического градиентного спуска. В поле _params_ запроса задаются следующие параметры стохастического градиентного спуска:
- eta0 - начальная скорость обучения
- alpha - коэффициент регуляризации
- epoch - количество эпох обучения - проходов по обучающим данным
- batch_size - размер одного пакета
- init_w - начальные значения коэффициентов, это поле не является обязательным
        
Пример запроса:
```
{
    "action": "train_gradient_model",
    "params":{
        "eta0" : 0.0001,
        "alpha": 0.0001,
        "epoch": 50,
        "batch_size": 32
    }
}
```

#Получение предсказаний
В поле params такого запроса должны содержаться:
 - columns - имена соответствующих входных значений, значения столбцов в таблице.
 - predictors - двойной массив с входными значеними. Значения каждой модели содержатся в отдельных массивах.
 - type - указывает модель, с помощью которой нужно получить значения. Возможные значения:
   - polynom - модель третей степени
   - gradient - модель четвертой степени
   
 Пример запроса:
```
{
    "id": "1",
    "action": "predict",
    "params":{
        "type": "polynom",
        "columns": ["input_Depth", "input_Por", "input_Per", "input_Sw0", "input_Den_r", "input_vis_oil", "input_vis_wat", "input_Cw0", "input_Cw1", "input_delta", "input_Den_w", "input_Qx", "input_Qy", "input_Ts", "input_zb", "input_kk_per_0", "input_n_wat", "input_n_oil", "input_Sw1", "input_Per_cake", "input_Por_cake", "values.A", "values.C0", "values.S0", "values.phi0", "values.phi", "values.q", "values.g", "time"],
        "predictors":[
            [2600.0,0.1,2e-14,0.65,2600.0,0.003,0.001,0.02,0.001,0.045,1000.0,0.99,0.99,12000000.0,0.05,0.99,2.0,3.0,1.0,8e-17,0.6,2.0,3.0,0.0,0.0,0.1,2.0,2.0,2],
            [2600.0,0.1,2e-14,0.65,2600.0,0.003,0.001,0.02,0.001,0.045,1000.0,0.99,0.99,12000000.0,0.05,0.99,2.0,3.0,1.0,8e-17,0.6,2.0,3.0,0.0,0.0,0.1,2.0,2.0,3]
        ]
    }
}
```
Ответ содержит id запроса, значения столбцов и двойной массив с полученными значениями.

Пример ответа:
```
{
    "id": "1",
    "columns":
    [
        "values.rk~DF20", "values.rk~DF16", "values.rk~DF14", "values.rk~DF11", "values.rk~DF10", "values.rk~DF08", "values.rk~DF07", "values.rk~DF06", "values.rk~DF05"
    ],
    "data":
    [
        [3.053991347950186, 3.089167024313058, 3.14871219960868, 3.2274161477757413, 3.3585265418205554, 3.4770087542639976, 3.672145653003854, 3.7894786626653634, 3.959692365004875],
        [3.06988749787834, 3.1144253683226837, 3.1911012515164323, 3.281839959130733, 3.436324913181969, 3.560505125369648, 3.771541241278403, 3.8813199304713932, 4.042975885264695]
    ]
}
```
